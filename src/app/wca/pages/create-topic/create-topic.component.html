<nav aria-label="breadcrumb" class="coursebreadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a [routerLink]="['/Admin/auth/userManagement']">Home</a></li>
        <li class="breadcrumb-item"><a [routerLink]="['/Admin/auth/Wca']">Courses</a></li>

        <li class="breadcrumb-item">

            <a [routerLink]="['/Admin/auth/Wca/addcourse']"
                [queryParams]="{edit:'true',viewingModule:query.viewingModule}">
                Edit Courses
            </a></li>
        <ng-container>
            <li class="breadcrumb-item">
                <a [routerLink]="['/Admin/auth/Wca/addmodule']"
                    [queryParams]="{courseId:query.viewingModule,courseImage:query.image,courseName:query.courseName}">Add
                    Module</a>
            </li>
        </ng-container>

        <li *ngIf="query.isCreateTemp" class="breadcrumb-item">
            <a [routerLink]="['/Admin/auth/Wca/addtemplate']"
                [queryParams]="{addModule:query.addModule,viewingModule:query.viewingModule,image:query.image,courseName:query.courseName}">
                Create template
            </a>
        </li>
        <li *ngIf="query.isChooseTemp" class="breadcrumb-item">
            <a [routerLink]="['/Admin/auth/Wca/choosetemplate']"
                [queryParams]="{addModule:query.addModule,viewingModule:query.viewingModule,image:query.image,courseName:query.courseName}">
                Choose template
            </a>
        </li>
        <li class="breadcrumb-item active">
            <ng-container *ngIf="query.edit; else isNoEdit">
                Edit content
            </ng-container>
            <ng-template #isNoEdit>
                Create content
            </ng-template>
        </li>
    </ol>
</nav>

<div *ngIf="!queryData?.template_details || queryData === undefined" class="dspFlx">
    <span style="color: red;">Go Back and Choose or Create the Template Please !!!</span>
</div>


<span *ngIf="createTopicForm?.controls">
    <form [formGroup]="createTopicForm" (ngSubmit)="addTopicFrom()" class="formHeight">
        <div class="container wrap-body">
            <div class="row">
                <div class="col-md-8 moduleInput">
                    <label *ngIf="queryData?.template_details" class="firstSpan"> Enter Module Name<span>:</span></label>
                <div *ngIf="queryData?.template_details">
                    <input class="Bcg" type="text" #modName placeholder="Enter the Name" formControlName="modulename"
                        required />
                </div>
                <div class="validmodule"> <small
                        *ngIf="createTopicForm?.controls?.modulename?.errors?.required && submitted">Module Name
                        Required !!!</small>
                </div>
                </div>
            </div>


            <span *ngIf="createTopicForm?.get('moduledetails')?.controls">
                <div [hidden]="j?.value?.topicstatus === 'false'" class="row" formArrayName="moduledetails"
                    *ngFor="let j of createTopicForm.get('moduledetails').controls; let i = index;">

                    <div class="col-md-12 templatesList">
                        <mat-accordion>
                            <mat-expansion-panel [expanded]="true" class="bcgClrSync">

                                <mat-card style="text-align: center;">
                                    <mat-grid-list [cols]="breakpoint" rowHeight="1.70:2">

                                        <div class="example-list">
                                            <div *ngIf="queryData">
                                                <div class="example-box1">
                                                    <div (click)="activate(queryData?.template_details[i])"
                                                        class="clickBcg bcgBorder"
                                                        [class.active]="queryData?.template_details[i]?.name === active?.name">
                                                        <div class="dspFlx" [formGroupName]="i">
                                                            <span class="restictWidth">
                                                                <mat-form-field class="matWidth" appearance="outline">
                                                                    <input matInput style="color:black;height: 21px;"
                                                                        formControlName="topicname"
                                                                        placeholder="Topic Name">
                                                                    <mat-error
                                                                        *ngIf="(!j?.value?.topicname) && submitted">
                                                                        Topic Name Required !!! </mat-error>
                                                                </mat-form-field>

                                                            </span>
                                                            <span class="example-spacer"></span>
                                                            <span *ngIf="query">
                                                                <mat-icon style="display: none;">save</mat-icon>
                                                                <mat-icon (click)="DeleteTopic(i,$event)">delete
                                                                </mat-icon>
                                                            </span>
                                                        </div>
                                                        <div class="colView">
                                                            <div
                                                                *ngIf="queryData?.template_details[i].name != 'Feedback' && queryData?.template_details[i].name != 'Video'">
                                                                <input style="display: none;" [id]="'fileInput3'+i"
                                                                    type='file' #fileInput3
                                                                    (change)="onSelectFile($event,queryData?.template_details[i],j,i)">
                                                                <span (dblclick)="fileInput3.click()"><img class="img1"
                                                                        src="{{queryData?.template_details[i]?.image}}"></span>
                                                            </div>
                                                            <div
                                                                *ngIf="queryData?.template_details[i].name === 'Feedback' || queryData?.template_details[i].name === 'Video'">
                                                                <span><img class="img1"
                                                                        src="{{queryData?.template_details[i]?.image}}"></span>
                                                            </div>
                                                            <span
                                                                class="padTop">{{queryData?.template_details[i]?.name}}</span>
                                                            <span class="padTop1 showCon"
                                                                *ngIf="!j?.value?.topicimages[0] &&  queryData?.template_details[i].name != 'Feedback' && queryData?.template_details[i].name != 'Video'">
                                                                <small>Content is
                                                                    empty double click to edit</small></span>
                                                                <!--added now for knowledege check-->
                                                            <div class="row UploadBlock"
                                                                *ngIf="queryData?.template_details[i].name === 'Knowledge Check'"
                                                                [class.active]="queryData?.template_details[i]?.name==active?.name">
                                                                <div class="col-md-4">
                                                                    <button *ngIf="j?.value?.topicimages[0]"
                                                                        mat-raised-button class="btnprev" type="button"
                                                                        (click)="openPreviewModal(createTopicForm,i)">preview</button>
                                                                </div>
                                                                <div class="col-md-4 uploadKC">
                                                                    <div class="ml5">
                                                                        <mat-icon class="knowledgeIcon"
                                                                            (click)="sampleDownload()">get_app
                                                                        </mat-icon>
                                                                        <label class="fsize12">Download question
                                                                            template</label>
                                                                    </div>
                                                                    <div class="ml5">
                                                                        <input style="display: none;"
                                                                            [id]="'fileInput4'+i" type='file'
                                                                            #fileInput4
                                                                            (change)="onSelectFile($event,queryData?.template_details[i],j,i)">
                                                                        <span (click)="fileInput4.click()">
                                                                            <mat-icon class="knowledgeIcon">publish
                                                                            </mat-icon>
                                                                        </span><label class="fsize12">Upload
                                                                            Question</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <div *ngIf="j?.value?.topicimages[0]"
                                                                        class="ml10 mt10" [formGroupName]="i">
                                                                        <span class="dspFlxinside ml10">
                                                                            <small class="spanTime"> Time required to
                                                                                complete
                                                                                the topic * </small>
                                                                                <input type="text" class="timeInput" formControlName="topictime" mask="00:m0:s0" [validation]="false" [dropSpecialCharacters]="false" (keypress)="isNumberKey($event)" placeholder="00:00:00">
                                                                        </span>
                                                                        <mat-error
                                                                            *ngIf="(!j?.value?.topictime) && submitted">
                                                                            Time required </mat-error>
                                                                        <!-- <mat-error
                                                                            *ngIf="(j?.controls?.topictime.hasError('mask')) && submitted">
                                                                            Invalid time format
                                                                        </mat-error> -->

                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!--added now for knowledege check-->

                                                            <!-- added for new template -->
                                                            <div class="row UploadBlock"
                                                                *ngIf="j?.value?.topicimages[0] && queryData?.template_details[i].name != 'Knowledge Check' && queryData?.template_details[i].name != 'Video'"
                                                                [class.active]="queryData?.template_details[i]?.name==active?.name">
                                                                <div class="col-md-6">
                                                                    <span style="width:20%"><button
                                                                            *ngIf="queryData?.template_details[i].name != 'SCORM'"
                                                                            mat-raised-button class="btnprev ml30 fleft"
                                                                            type="button"
                                                                            (click)="previewimages(j,$event,queryData?.template_details[i])">preview</button>
                                                                        <span
                                                                            *ngIf="j?.value?.topicimages[0] && queryData?.template_details[i].name == 'SCORM'"
                                                                            class="UploadBlock ml30 fleft"
                                                                            [class.active]="queryData?.template_details[i]?.name==active?.name">
                                                                            <label style="font-size: 12px;">File
                                                                                Uploaded</label>
                                                                        </span>
                                                                    </span>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <span [formGroupName]="i">
                                                                        <span class="dspFlxinside ml35">
                                                                            <small class="spanTime"> Time required to complete
                                                                                the topic * </small>
                                                                                <input type="text" class="timeInput" (keypress)="isNumberKey($event)" mask="00:m0:s0" [validation]="false" [dropSpecialCharacters]="false" formControlName="topictime" placeholder="00:00:00">
                                                                        </span>
                                                                        <mat-error
                                                                            *ngIf="(!j?.value?.topictime) && submitted">
                                                                            Time required </mat-error>
                                                                        <mat-error
                                                                            *ngIf="(j?.controls?.topictime.hasError('pattern')) && submitted">
                                                                            Invalid time format
                                                                        </mat-error>

                                                                    </span>
                                                                </div>
                                                            </div>
                                                            <!-- added for new template -->

                                                            <!-- added now for feedback -->
                                                            <div class="row UploadBlock"
                                                                *ngIf="queryData?.template_details[i].name == 'Feedback'"
                                                                [class.active]="queryData?.template_details[i]?.name==active?.name">
                                                                <div class="col-md-6">
                                                                    <span><button mat-raised-button
                                                                            class="btnprev feedbacBtn" type="button"
                                                                            (click)="openFeedback()">preview</button></span>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <span class="ml10" [formGroupName]="i">
                                                                        <span class="dspFlxinside ml35">
                                                                            <small class="spanTime"> Time required to complete
                                                                                the topic * </small>
                                                                                <input type="text" class="timeInput" (keypress)="isNumberKey($event)" mask="00:m0:s0" [validation]="false" [dropSpecialCharacters]="false" formControlName="topictime" placeholder="00:00:00">
                                                                        </span>
                                                                        <mat-error
                                                                            *ngIf="(!j?.value?.topictime) && submitted">
                                                                            Time required</mat-error>
                                                                        <mat-error
                                                                            *ngIf="(j?.controls?.topictime.hasError('pattern')) && submitted">
                                                                            Invalid time format
                                                                        </mat-error>
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            <!-- added now for feedback -->

                                                            <div class="UploadVidBlock row previewAndTime"
                                                                *ngIf="queryData?.template_details[i].name === 'Video'"
                                                                [class.active]="queryData?.template_details[i]?.name==active?.name">
                                                                <div class="col-md-4">
                                                                    <div class="vidCol1">
                                                                        <div class="subTitle">
                                                                            <mat-slide-toggle
                                                                                [checked]="j?.value?.videosubtitle"
                                                                                (change)="toggle_sub_trans($event,'subtitle',j)">
                                                                                Subtitle</mat-slide-toggle>
                                                                        </div>
                                                                        <div *ngIf="j?.value?.videosubtitle == 'True'">
                                                                            <div class="subTitleUpload"
                                                                                *ngFor="let no of j.value.topicimages[0].title;let subTitleindex = index">
                                                                                <div class="initalAlign">
                                                                                    <label class="vttLable">{{no.vttfile}}</label>
                                                                                </div>
                                                                                <div style="display: flex;">
                                                                                <mat-select [(value)]="selected"
                                                                                    class="subSelect"
                                                                                    placeholder="Language">
                                                                                    <mat-option
                                                                                        *ngFor="let item of language"
                                                                                        class="h30" [value]="item.name">
                                                                                        {{item.name}}</mat-option>
                                                                                </mat-select>
                                                                                <div class="chooseFile">
                                                                                    <input style="display: none;"
                                                                                        [id]="'fileInput4'+i"
                                                                                        type='file' #fileInput4
                                                                                        (change)="onSelectFile($event,queryData?.template_details[i],j,i,j?.value?.topicimages[0].file,subTitleindex)">
                                                                                    <button (click)="fileInput4.click()"
                                                                                        class="subButton"
                                                                                        type="button">Choose
                                                                                        file</button>
                                                                                </div>
                                                                                <div class="addSub">
                                                                                    <mat-icon *ngIf="subTitleindex == 0"
                                                                                        (click)="addSubTile('sub',j,subTitleindex)">
                                                                                        add_circle</mat-icon>
                                                                                    <mat-icon *ngIf="subTitleindex != 0"
                                                                                        (click)="removeSubTile(subTitleindex,'sub',j)">
                                                                                        delete</mat-icon>
                                                                                </div>
                                                                            </div>
                                                                            </div>
                                                                        </div>

                                                                        <!-- code commented for transcript option - future purpose  -->
                                                                        <!-- <div class="transcript">
                                                                            <mat-slide-toggle [checked]="transcriptVal" (change)="toggle_sub_trans($event,'transcript')">Transcript</mat-slide-toggle>
                                                                        </div>
                                                                        <div *ngIf="showTransupload">
                                                                            <div class="subTitleUpload" *ngFor="let no of transcripts;let i = index">
                                                                                <mat-select class="subSelect" placeholder="Language">
                                                                                    <mat-option class="h30" value="English">English</mat-option>
                                                                                  </mat-select>                                                                                 
                                                                            <div class="chooseFile">
                                                                                <button class="subButton" type="button">Choose file</button>
                                                                            </div>
                                                                              <div class="addSub">
                                                                                <mat-icon *ngIf="i == 0" (click)="addSubTile('tra')">add_circle</mat-icon>
                                                                                <mat-icon *ngIf="i != 0" (click)="removeSubTile(i,'tra')">delete</mat-icon>
                                                                              </div>
                                                                        </div>
                                                                        </div> -->
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <div class="input-container" [formGroupName]="i">
                                                                        <input class="input-field" type="text"
                                                                            formControlName="topicvalue"
                                                                            placeholder="Add url"
                                                                            (paste)="onSelectFile($event,queryData?.template_details[i],j,i,$event.clipboardData.getData('Text'))"
                                                                            (input)="onSelectFile($event,queryData?.template_details[i],j,i,$event.target.value)"
                                                                            required />
                                                                        <button class="input-button"
                                                                            (click)="loadBlobs($event,queryData?.template_details[i],j,i,'')"
                                                                            type="button">Browse</button>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <div class="vidCol3" [formGroupName]="i">
                                                                        <span class="ml10" style="height: 33px;">
                                                                            <span class="dspFlxinside">
                                                                                <small class="spanTime"> Time required
                                                                                    to complete
                                                                                    the topic *</small>
                                                                                    <input type="text" class="timeInput" (keypress)="isNumberKey($event)" mask="00:m0:s0" [validation]="false" [dropSpecialCharacters]="false" formControlName="topictime" placeholder="00:00:00">
                                                                            </span>
                                                                            <mat-error
                                                                                *ngIf="(!j?.value?.topictime) && submitted">
                                                                                Time required</mat-error>
                                                                            <!-- <mat-error
                                                                                *ngIf="(j?.controls?.topictime.hasError('pattern')) && submitted">
                                                                                Invalid time format
                                                                            </mat-error> -->

                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            </div>


                                                            <span
                                                                *ngIf="!j?.value?.topicimages[0] && submitted && queryData?.template_details[i].name != 'Feedback' && !j?.value?.topicimages[0] && submitted && queryData?.template_details[i].name != 'Video'"><small
                                                                    class="FileuploadValid">File Upload
                                                                    Required!!!</small></span>
                                                            <span
                                                                *ngIf="!j?.value?.topicvalue && submitted && queryData?.template_details[i].name == 'Video'"><small
                                                                    class="FileuploadValid">URL
                                                                    Required!!!</small></span>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                    </mat-grid-list>
                                </mat-card>
                            </mat-expansion-panel>
                        </mat-accordion>
                    </div>
                </div>
            </span>
            <div *ngIf="queryData?.template_details" class="dspFlx">
                <button class="backgroundcol2" (click)="addTopicFrom($event,'draft')" type="button">Save as
                    draft</button>
                <span class="padTwoSides"> <button class="backgroundcol1" (click)="addTopicFrom($event,'create')"
                        type="button">Create</button></span>
                <button class="backgroundcol1" (click)="onCancel()" type="button">Cancel</button>

            </div>
        </div>
    </form>

    <!-- Knowledge check preview modal -->
    <div class="modal fade preivewodal backdropModal" id="knowlegeCheckModal" role="dialog" data-backdrop="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <label class="modal-title">Knowledge Check</label>
                </div>
                <div class="modal-body">
                    <owl-carousel-o *ngIf="displaySlides" [options]="KnowledgeOptions" class="questionList">
                        <ng-template *ngFor="let value of questionPreData;let i = index" carouselSlide>
                            <div class="questionContainer">
                                <perfect-scrollbar class="scrollbar-container">
                                    <div class="queValue">
                                        Question &nbsp;{{i + 1}}
                                    </div>
                                    <div class="queQuery">
                                        {{value.Question}}
                                    </div>
                                    <ng-container>
                                        <section class="queOptions">
                                            <mat-radio-group disabled>
                                                <div>
                                                    <mat-radio-button value="Option1"><span>{{value.Option1}}</span>
                                                    </mat-radio-button>
                                                </div>
                                                <div>
                                                    <mat-radio-button value="Option2"><span>{{value.Option2}}</span>
                                                    </mat-radio-button>
                                                </div>
                                                <div>
                                                    <mat-radio-button value="Option3"><span>{{value.Option3}}</span>
                                                    </mat-radio-button>
                                                </div>
                                                <div>
                                                    <mat-radio-button value="Option4"><span>{{value.Option4}}</span>
                                                    </mat-radio-button>
                                                </div>
                                            </mat-radio-group>
                                        </section>
                                    </ng-container>
                                    <div class="queValue">
                                        Answer
                                    </div>
                                    <div class="queAnswer">
                                        {{value.Answer}}
                                    </div>
                                    <div class="queValue">
                                        Reason
                                    </div>
                                    <div class="queAnswer">
                                        {{value.Reason}}
                                    </div>
                                </perfect-scrollbar>
                            </div>
                            <!-- <div class="mright34">
                        <button class="backgroundcol1 cancelBtn" type="button">Cancel</button>
                        <button class="backgroundcol2" type="button">Save</button>
                       </div> -->
                        </ng-template>
                    </owl-carousel-o>
                </div>
            </div>

        </div>
    </div>

    <!-- Feedack modal -->
    <div class="modal fade preivewodal backdropModal" id="feedbackModal" role="dialog" data-backdrop="false">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <label class="modal-title">Feedback</label>
                </div>
                <div class="modal-body">
                    <div class="mar3">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th *ngFor="let title of feedBackFormHeading">{{title}}</th>

                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let value of feedBackForm">
                                    <td>{{value.title}}</td>
                                    <td *ngFor="let value1 of value.star"><span class="fa fa-star starRating"></span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <label>What do you like about module</label><br />
                        <textarea disabled style="margin-top:5px;" class="form-control" rows="3" cols="55" id="comment"
                            placeholder=""></textarea>
                        <br />

                        <label>What could be improved</label><br />
                        <textarea disabled style="margin-top:5px;" class="form-control" rows="3" cols="55" id="comment1"
                            placeholder=""></textarea>
                        <br />
                    </div>
                </div>
            </div>

        </div>
    </div>
</span>

<div class="modal fade preivewodal backdropModal" id="confirmModal" role="dialog" data-backdrop="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body pad5">
                <label>Are you sure to delete this template?</label>
            </div>
            <div class="modal-footer">
                <button class="backgroundcol1" type="button" data-dismiss="modal">No</button>
                <button class="backgroundcol1 BgBtn" type="button" (click)=confirmDelete()>Yes</button>
            </div>
        </div>
    </div>
</div>