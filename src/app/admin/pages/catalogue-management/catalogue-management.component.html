<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/Admin/auth/catalogue">Home</a></li>
    <li class="breadcrumb-item active" aria-current="page">Catagory Management</li>
  </ol>
</nav>

<!-- Remember to sigin to admin before hitting this url
navigate by url -- Admin/auth/catalogue -->
<div class="container profile p-30">
  <div class="container m-t-20 card-shadow ">
    <div class="row card-shadow">
      <!-- Mat tree code here ( left hand side) -->
      <div class="card col-3 cardheight left">

        <mat-tree [dataSource]="treeSource" [treeControl]="treeControl" [trackBy]="trackBy">
          <!-- This is the tree node template for leaf nodes -->
          <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>
            <li class="mat-tree-node newstyle" renderDebug>
              <!-- use a disabled button to provide padding for tree leaf -->
              <button mat-icon-button matTreeNodeToggle class="btnClassicon" (click)="loadsubcategory(node)"
                [attr.aria-label]="'toggle ' + node.name">
                <mat-icon *ngIf="!node?.super_sub_category_name" class="mat-icon-rtl-mirror">
                  {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                </mat-icon>
              </button>
              <mat-checkbox name="checkbox" [(ngModel)]="node.checkbox" (change)="selectedcategory(node)">
                {{node?.category_name}} {{node?.sub_category_name}} {{node?.super_sub_category_name}}</mat-checkbox>
            </li>
          </mat-tree-node>

          <!-- node with children -->
          <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
            <li class="mat-tree-node newstyle" renderDebug>
              <div class="mat-tree-node">
                <button mat-icon-button matTreeNodeToggle class="btnClassicon"
                  [attr.aria-label]="'toggle ' + node.name">
                  <mat-icon *ngIf="!node?.super_sub_category_name" class="mat-icon-rtl-mirror">
                    {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                  </mat-icon>
                </button>
                <mat-checkbox name="checkbox" [(ngModel)]="node.checkbox" (change)="selectedcategory(node)">
                  {{node?.category_name}} {{node?.sub_category_name}} {{node?.super_sub_category_name}}</mat-checkbox>
                <!-- {{node.group_name}}2 -->
              </div>
            </li>
            <ul [class.children-invisible]="!treeControl.isExpanded(node)">
              <ng-container matTreeNodeOutlet></ng-container>
            </ul>
          </mat-nested-tree-node>
        </mat-tree>
        <!-- view category and sub category -->
      </div>
      <!-- end of Mat tree code here ( left hand side) -->

      <!-- start of right hand side card view -->

      <div class="card col-9 cardheight right">

        <!-- start of navigations ( engineering > electronics > nano electronics) -->
        <ol class="breadcrumb category-nav m-b-0 m-l-20">
          <li class="breadcrumb-item" (click)="selectedCategory?.category_name != undefined && changeNav('addCategoryForm')" *ngIf="showAddCatForm || selectedCategory?.category_name != undefined;">
            {{selectedCategory?.category_name || 'Category'}}</li>
          <li *ngIf="showAddSubCatForm || selectedSubCategory?.sub_category_name != undefined" 
          (click)="selectedSubCategory?.sub_category_name != undefined && changeNav('addSubCategoryForm')" aria-current="page" class="breadcrumb-item">{{selectedSubCategory.sub_category_name || 'Sub Category'}}</li>
          <li class="breadcrumb-item active" (click)="selectedSuperSubCategory?.super_sub_category_name != undefined && 
          changeNav('addSuperSubCategoryForm')" *ngIf="selectedSuperSubCategory?.super_sub_category_name != undefined" aria-current="page">{{selectedSuperSubCategory.super_sub_category_name}}</li>
        </ol>
        <!-- end of navigations ( engineering > electronics > nano electronics) -->

        <hr class="header-line m-r-20 m-l-20">

        <!-- start of buttons (add, edit, dlt) -->
        <div class="row">
          <div class="col-lg-5 col-md-5 col-sm-12 col-12">
            <span class="f_size_16 f_wt_500 m-l-5 color_grey" *ngIf = "selectedCategory?.category_name != undefined && 
            selectedSubCategory ?.sub_category_name == undefined && selectedSuperSubCategory ?.super_sub_category_name == undefined">
              {{selectedCategory?.category_name}}
              <span class="material-icons none" style="vertical-align: middle;"
                *ngIf="selectedCategory?.category_description != undefined"
                matTooltip="{{selectedCategory?.category_description || 'Category Description'}}">info_outline</span>
            </span>
            <span class="f_size_16 f_wt_500 m-l-5 color_grey" *ngIf = "selectedCategory?.category_name != undefined && 
            selectedSubCategory ?.sub_category_name != undefined && selectedSuperSubCategory ?.super_sub_category_name == undefined">
              {{selectedSubCategory?.sub_category_name}}
              <span class="material-icons none" style="vertical-align: middle;"
                matTooltip="{{selectedSubCategory ?.sub_category_description || 'Sub Category Description'}}">info_outline</span>
            </span>
            <span class="f_size_16 f_wt_500 m-l-5 color_grey" *ngIf = "selectedCategory?.category_name != undefined && 
            selectedSubCategory ?.sub_category_name != undefined && selectedSuperSubCategory ?.super_sub_category_name != undefined">
              {{selectedSuperSubCategory?.super_sub_category_name}}
              <span class="material-icons none" style="vertical-align: middle;"
                matTooltip="{{selectedSuperSubCategory?.super_sub_category_description || 'Sub Category Description'}}">info_outline</span>
            </span>

          </div>
          <div class="col-lg-7 col-md-7 col-sm-12 col-12">
            <div class="row">
              <!-- <div class="col-lg-2"></div> -->
              <div class="col-md-3 col-lg-3  col-sm-5 center col-5">
                <button mat-raised-button *ngIf="showCourses"
                  class="background-blue width_80 m-b-10 moveTo-btn color_white" (click)="openMoveTo(viewDialog)"
                  [disabled]="selectedArray.length == 0">
                  <span class="material-icons" style="vertical-align: middle;">domain</span>Move To
                </button>
              </div>
              <div class="col-md-3 col-lg-3  col-sm-5 center col-5">
                <button mat-raised-button
                  [disabled]="showCourses ||
                   (addCategoryForm && (addCategoryForm?.value?.category_name != '' || addCategoryForm?.value?.category_description != '' || addCategoryForm?.value?.category_image != '') 
                && !selectedCategory?.category_name) ||
                 (addSubCategoryForm && (addSubCategoryForm?.value?.sub_category_name != '' || addSubCategoryForm?.value?.sub_category_description != '')
                  && !selectedSubCategory?.sub_category_name) || 
                  (addSuperSubCategoryForm )"
                  class="add-btn width_80 m-b-10 color_white" (click)="gotoAdd()">
                  <span class="material-icons" style="vertical-align: middle;">add</span>Add</button>
              </div>
              <div class="col-md-3 col-lg-3  col-sm-5 center col-5">
                <button mat-raised-button [disabled]="true" class="edit-btn width_80 m-b-10 color_white">
                  <span class="material-icons" style="vertical-align: middle;" (click)="gotoEdit()">create</span>Edit
                </button>
              </div>
              <div class="col-md-3 col-lg-3  col-sm-5 center col-5">
                <button mat-raised-button [disabled]="true" class="delete-btn width_80 m-b-10 color_white">
                  <span class="material-icons" style="vertical-align: middle;"
                    (click)="gotoDelete()">delete</span>Delete
                </button>
              </div>
            </div>
          </div>
        </div>
        <!-- end of buttons (add, edit, dlt) -->

        <!-- start of landing 3 line rules -->
        <br>
        <div class="m-l-20" *ngIf="showHome">
          <br><br>
          <div class="landing-text landing-background">
            <p>
              <mat-icon class="m-b-10">done</mat-icon>Add categories upto 3 levels
            </p>
            <br>
            <p>
              <mat-icon class="m-b-10">done</mat-icon>Edit existing category name and description
            </p>
            <br>
            <p>
              <mat-icon class="m-b-10">done</mat-icon>Delete a category after removing all courses and subcategories
              associated with it
            </p>
          </div>
        </div>

        <!-- start of Add Catagory code  -->
        <div *ngIf="showAddCatForm">
          <form [formGroup]="addCategoryForm">
            <div class="row">
              <div class="col-md-4 col-lg-4 col-sm-10 col-10 m-l-5">
                <input type="text" class="inputs border-radius-5 background_trans width_100" placeholder="Category *"
                  [ngClass]="{ 'is-invalid': f.category_name.touched && f.category_name.errors }"
                  formControlName="category_name">
                <div *ngIf="f.category_name.touched && f.category_name.errors" class="invalid-feedback">
                  <div *ngIf="f.category_name.errors.required">* Category Name is required</div>
                </div>
              </div>
            </div>
            <br>
            <div class="row">
              <div class="col-md-11 col-lg-11 m-l-5 col-sm-10 col-10">
                <div class="form-group">
                  <textarea style="resize: none;" rows="5"
                    [ngClass]="'inputs border-radius-5 background_trans width_100'"
                    [ngClass]="{ 'is-invalid': f.category_description.touched && f.category_description.errors }"
                    placeholder="Description" formControlName="category_description"
                    name="category_description"></textarea>
                  <!-- <div *ngIf="f.category_description.touched && f.category_description.errors" class="error_msg">
                    <div *ngIf="f.category_description.errors.required">* Category Description is required</div>
                  </div> -->
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-3 col-lg-3 h_100px col-sm-10 col-10 m-l-5 inputs border-radius-5">
                <mat-label class="color_grey"
                  *ngIf="addCategoryForm.value.category_image == null || addCategoryForm.value.category_image == ''">
                  Category Image *</mat-label>
                <div class="row" appDnd (click)="fileInput.click()" (fileDropped)="uploadFile($event)"
                  *ngIf="addCategoryForm.value.category_image == null || addCategoryForm.value.category_image == ''">
                  <div class="spinner-container" *ngIf="loading">
                    <mat-spinner diameter="30"></mat-spinner>
                  </div>
                  <div class="col-md-5 col-sm-12 col-12 pointer">
                    <input hidden #fileInput (change)="uploadFile($event.target.files)" accept=".png,.jpg,.jpeg"
                      id="fileInput" type='file'>
                    <img class="img1 verticle_middle marginClass" [src]="'assets/images/image_upload.svg'">
                  </div>
                  <div class="col-md-7 col-sm-0 col-0 pointer center f_size_12 none"
                    (change)="uploadFile($event.target.files)">
                    Click here <br> Or <br> Drag and drop here
                  </div>
                </div>
                <div class="row"
                  *ngIf="!(addCategoryForm.value.category_image == null || addCategoryForm.value.category_image == '')">
                  <img class="center width_80 imgHt" [src]="addCategoryForm.value.category_image">
                </div>
              </div>
            </div>
            <br>
            <div class="row" *ngIf="selectedCategory?.category_name == undefined">
              <div class="col-lg-8 col-md-6"></div>
              <div class="col-lg-2 col-md-3 center col-sm-6 col-6">
                <button id="addCategory" mat-stroked-button [disabled]="addCategoryForm.invalid"
                  class="width_80 border-radius-5 background-blue color_white center"
                  (click)="addCategory('category')">Save</button>
              </div>
              <div class="col-lg-2 col-md-3 center col-sm-6 col-6">
                <button id="cancel" mat-stroked-button class="width_80 border-radius-5 center">Cancel</button>
              </div>
            </div>
            <div class="row" *ngIf="selectedCategory?.category_name">
              <div class="col-md-2 m-l-5 col-sm-6 col-6">
                <br>
                <button id="viewCourse" mat-stroked-button
                  class="width_80 border-radius-5 background-blue color_white center"
                  (click)="showCourses = !showCourses">View
                  Courses</button>
              </div>
            </div>
            <br>
          </form>
        </div>
        <!-- end of Add Catagory code  -->

        <!-- start of Add Sub Catagory code  -->
        <div *ngIf="showAddSubCatForm">
          <form [formGroup]="addSubCategoryForm">
            <div class="row">
              <div class="col-md-4 col-sm-10 col-10 m-l-5">
                <input type="text" class="inputs border-radius-5 background_trans width_100" placeholder="SubCategory *"
                  [ngClass]="{ 'is-invalid': f.sub_category_name.touched && f.sub_category_name.errors }"
                  formControlName="sub_category_name">
                <div *ngIf="f.sub_category_name.touched && f.sub_category_name.errors" class="invalid-feedback">
                  <div *ngIf="f.sub_category_name.errors.required">* Sub Category Name is required</div>
                </div>
              </div>
            </div>
            <br>
            <div class="row">
              <div class="col-md-11 m-l-5 col-sm-10 col-10">
                <div class="form-group">
                  <textarea style="resize: none;" rows="5"
                    [ngClass]="'inputs border-radius-5 background_trans width_100'"
                    [ngClass]="{ 'is-invalid': f.sub_category_description.touched && f.sub_category_description.errors }"
                    placeholder="Description" formControlName="sub_category_description"
                    name="sub_category_description"></textarea>
                  <!-- <div *ngIf="f.sub_category_description.touched && f.sub_category_description.errors"
                    class="error_msg">
                    <div *ngIf="f.sub_category_description.errors.required">* Sub Category Description is required</div>
                  </div> -->
                </div>
              </div>
            </div>
            <br>
            <div class="row" *ngIf="selectedSubCategory?.sub_category_name == undefined">
              <div class="col-md-8"></div>
              <div class="col-md-2 center col-sm-6 col-6">
                <button id="addSubCategory" mat-stroked-button [disabled]="addSubCategoryForm.invalid"
                  class="width_80  border-radius-5 background-blue color_white center"
                  (click)="addCategory('subcategory')">Save</button>
              </div>
              <div class="col-md-2 center col-sm-6 col-6">
                <button id="cancel" mat-stroked-button class="width_80 border-radius-5 center">Cancel</button>
              </div>
            </div>
            <div class="row" *ngIf="selectedSubCategory?.sub_category_name">
              <div class="col-md-2 m-l-5 col-sm-6 col-6">
                <br>
                <button id="viewCourse" mat-stroked-button
                  class="width_80 border-radius-5 background-blue color_white center"
                  (click)="showCourses = !showCourses">View
                  Courses</button>
              </div>
            </div>
            <br>
          </form>
        </div>
        <!-- end of Add Sub Catagory code  -->

        <!-- start of Add Sub Catagory code  -->
        <div *ngIf="showAddSuperSubCatForm">
          <form [formGroup]="addSuperSubCategoryForm">
            <div class="row">
              <div class="col-md-4 col-sm-10 col-10 m-l-5">
                <input type="text" class="inputs border-radius-5 background_trans width_100" placeholder="SubCategory *"
                  [ngClass]="{ 'is-invalid': f.super_sub_category_name.touched && f.super_sub_category_name.errors }"
                  formControlName="super_sub_category_name">
                <div *ngIf="f.super_sub_category_name.touched && f.super_sub_category_name.errors"
                  class="invalid-feedback">
                  <div *ngIf="f.super_sub_category_name.errors.required">* Sub Category Name is required</div>
                </div>
              </div>
            </div>
            <br>
            <div class="row">
              <div class="col-md-11 m-l-5 col-sm-10 col-10">
                <div class="form-group">
                  <textarea style="resize: none;" rows="5"
                    [ngClass]="'inputs border-radius-5 background_trans width_100'"
                    [ngClass]="{ 'is-invalid': f.super_sub_category_description.touched && f.super_sub_category_description.errors }"
                    placeholder="Description" formControlName="super_sub_category_description"
                    name="super_sub_category_description"></textarea>
                  <!-- <div *ngIf="f.super_sub_category_description.touched && f.super_sub_category_description.errors"
                            class="error_msg">
                            <div *ngIf="f.super_sub_category_description.errors.required">* Sub Category Description is required</div>
                          </div> -->
                </div>
              </div>
            </div>
            <br>
            
            <div class="row" *ngIf="selectedSuperSubCategory?.super_sub_category_name == undefined">
              <div class="col-md-8"></div>
              <div class="col-md-2 center col-sm-6 col-6">
                <button id="addSubCategory" mat-stroked-button [disabled]="addSuperSubCategoryForm.invalid"
                  class="width_80  border-radius-5 background-blue color_white center"
                  (click)="addCategory('supersubcategory')">Save</button>
              </div>
              <div class="col-md-2 center col-sm-6 col-6">
                <button id="cancel" mat-stroked-button class="width_80 border-radius-5 center">Cancel</button>
              </div>
            </div>
            <div class="row" *ngIf="selectedSuperSubCategory?.super_sub_category_name">
              <div class="col-md-2 m-l-5 col-sm-6 col-6">
                <br>
                <button id="viewCourse" mat-stroked-button
                  class="width_80 border-radius-5 background-blue color_white center"
                  (click)="showCourses = !showCourses">View
                  Courses</button>
              </div>
            </div>
            <br>
          </form>
        </div>
        <!-- end of Add Sub Catagory code  -->

        <!-- start of view courses -->
        <div *ngIf="showCourses">
          <div class="row m-r-20">
            <div class="col-3">
              <button id="Hide_Courses" mat-stroked-button
                class="width_70 float-left border-radius-5 background-blue color_white center"
                (click)="hideCourses();showCourses = !showCourses">Hide Courses</button>
            </div>
            <div class="col-9"></div>
          </div>
          <div class="row m-t-10 m-r-20">
            <div class="col-9">
              <h3 class="font-display m-b-0">295 courses > </h3>
              <!-- <h2 class="font-display">{{course_count}} Courses > </h2> -->
            </div>
            <div class="col-3 p-r-0">
              <button id="selectAll" mat-stroked-button
                class="width_70 float-right border-radius-5 background-blue color_white center"
                (click)="selectAll()">Select All</button>
            </div>
          </div>
          <!-- <div class="row"> -->
          <div class="m-r-20 m-l-20">
            <mat-grid-list cols="4" [cols]="breakpoint" (window:resize)="onResize($event)" rowheight="2:1.7"
              gutterSize="30px">
              <mat-grid-tile *ngFor="let courses of courses; let i = index" [style.border]="'none'" [colspan]="1"
                [rowspan]="1">
                <mat-card class="course-card  font-display" (click)="selectCourse(courses,i+'c')">
                  <div class="container-fluid">
                    <img mat-card-image class="pointer" [ngClass]="{'overlayClass' : courses.isChecked || false}"
                      src="{{ courses.src }}" alt="" (click)="selectCourse(courses,i+'c')">
                    <!-- select image overlay -->

                    <div class="overlay">
                      <!-- <mat-icon class="Select-image" style="text-align: center; color: white; font-size: 500px">done
                    </mat-icon> -->
                    </div>
                  </div>
                  <mat-card-content class="center_align">
                    <p>{{courses.name}}</p>
                  </mat-card-content>
                </mat-card>
              </mat-grid-tile>
            </mat-grid-list>
            <!-- </div> -->
          </div>
        </div>

        <div class="row pos_bottom"
          *ngIf="!showCourses && !showHome && !showAddCatForm && !selectedCategory.category_name == undefined">
          <button id="viewCourse" mat-stroked-button class=" border-radius-5 background-blue color_white center "
            (click)="showCourses = !showCourses">View
            Courses</button>
        </div>

        <!-- end of view courses -->
      </div>
      <!-- end of right hand side card view -->
    </div>
  </div>


  <!-- start of popup -->
  <ng-template #viewDialog class="dialogPopup">
    <span class="close">
      <i class="fa fa-times-circle-o pointer color_blue" aria-hidden="true" (click)="closedialogbox()"></i>
    </span>
    <h2>Move {{selectedArray.length}} courses</h2>
    <mat-dialog-content style="width: 850px; height: 350px;">
      <div class="row ">
        <div class="col-md-3 m-b-10" *ngFor="let courseName of selectedArray;let j = index">
          <div class="center width_90 p-5px border border-radius-5">
            <span class="material-icons pointer" style="vertical-align: middle;" *ngIf="selectedArray.length > 1"
              (click)="selectCourse(courseName,j)">close</span> {{courseName.name}}
          </div>
        </div>
      </div>
      <hr>
      <mat-label>
        Choose Category
      </mat-label>
      <form [formGroup]="selectCategoryForm" class="m-t-20">
        <div class="row">
          <div class="form-group">
            <mat-form-field appearance="outline fill" class="width_100 category-label">
              <mat-label class="m-l-20">Category *</mat-label>
              <mat-select formControlName="category">
                <mat-option *ngFor="let cat of selectedArray" [value]="cat">
                  {{cat.name}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4" *ngIf="selectedArray.length > 0">
            <div class="form-group width_90">
              <mat-form-field appearance="outline fill" class="width_100 category-label">
                <mat-label class="m-l-20">Sub Category</mat-label>
                <mat-select formControlName="subCategory">
                  <mat-option *ngFor="let subcat of selectedArray" [value]="subcat">
                    {{subcat.name}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
          <div class="col-md-4" *ngIf="selectedArray.length > 0">
            <div class="form-group width_90">
              <mat-form-field appearance="outline fill" class="width_100 category-label">
                <mat-label class="m-l-20">Sub Category</mat-label>
                <mat-select formControlName="subSubCategory">
                  <mat-option *ngFor="let ssubcat of selectedArray" [value]="ssubcat">
                    {{ssubcat.name}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
          <div class="col-md-2"></div>
          <div class="col-md-2">
            <button id="moveTo" mat-stroked-button [disabled]="selectCategoryForm.invalid"
              class="width_80 background-blue color_white center alert-btn" (click)="moveCourses()">
              <span class="material-icons" style="vertical-align: middle;">domain</span> Move
            </button>
          </div>
        </div>
      </form>
    </mat-dialog-content>
    <br>
  </ng-template>

</div>