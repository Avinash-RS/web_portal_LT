<app-header></app-header>
<div class="container pl-0 pr-0">
  <div class="row ml-0 mr-0 errmsg" *ngIf="performDetails?.length == 0">
    <div class="col-12 m-auto text-center">
      <span class="errormsg">
        <img class="assignImg" alt="" src="assets/book.svg">
        <span>You have no perform activity at the moment!</span>
      </span>
    </div>
  </div>
  <div class="row ml-0 mr-0 mt-3">
    <div class="col-12 pl-0 pr-0">
      <div class="row ml-0 mr-0">
        <div class="col-12 text-left">
          <mat-icon class="arrowPopup mr-2" aria-hidden="false" (click)="mobileResponsive()">
            keyboard_backspace</mat-icon>
          <span class="f_wt_600 size catnamenew" (click)="mobileResponsive()">Back</span>
        </div>
      </div>
      <div class="row ml-0 mr-0 mt-3">
        <div class="col-12 pr-0">
          <p class="subTittle">{{indexNumber}}. {{performActivityData.module_id}}</p>
          <span
            >{{performActivityData.topic_id}}
          </span>
        </div>
      </div>
      <div class="row ml-0 mr-0 mt-3">
        <div class="col-8 pr-0">
          <div class="row mr-0 ml-0">
            <div class="col-5 mr-0 pl-0 pr-0 text-left">
              <span class="font-weight-bold">Start date:</span><br />
              <span>{{performActivityData.activitystartdate | date}}</span>
            </div>
            <div class="col-5 mr-0 pl-0 pr-0 text-left">
              <span class="m-l-5 font-weight-bold">End date:</span><br />
              <span class="m-l-5">{{performActivityData.activityenddate | date}}</span>
            </div>
            <div class="col-2 mr-0 pl-0 pr-0 text-left"></div>
          </div>
        </div>
        <div class="col-4 text-right pl-0">
          <p class="yettoSubmit" *ngIf="performActivityData.submit_status == 'notsubmitted'"><span class="dot"></span> Yet to submit</p>
          <p class="submitstatus" *ngIf="performActivityData.submit_status == 'submitted'"><span class="submitdot"></span>Submitted</p>
          <p class="gradeStatus" *ngIf="performActivityData.submit_status == 'graded'"><span class="gradedot"></span>Graded</p>
          <p class="textGrayColor">Iterations: <span *ngIf="performActivityData.submittedTotal > 0">{{performActivityData.submittedTotal}} / </span>{{performActivityData.iterationTotal}}<span></span></p>
          <!-- <span class="textGrayColor" *ngIf="perform.performActivity.submittedTotal > 0">{{perform.performActivity.submittedTotal}} / </span>{{perform.performActivity.iterationTotal}} -->
        </div>
      </div>
      <div class="row ml-0 mr-0 mt-3">
        <div class="col-12 pr-0 text-left">
          <p class="activityDisc font-weight-bold">Activity description:</p>
          <p class="brickMaking">{{performActivityData.activityname}}</p>
        </div>
      </div>
      <div class="row ml-0 mr-0">
        <div class="col-sm-12 text-left">
          <span>Material for activity ({{performActivityData.materialDetails.length}})</span>
        </div>
      </div>
      <div class="row ml-0 mr-0 mt-3">
        <div class="col-12 text-left pl-0 pr-0">

          <owl-carousel-o [options]="trendingCategorires"
          [ngClass]="performActivityData.materialDetails.length >= 4 ? 'arrow': 'widthClass arrow' ">
          <ng-template class="row ml-0 mr-0" carouselSlide
            *ngFor="let material of performActivityData.materialDetails; let i = index">
            <div [ngClass]="performActivityData.materialDetails.length >= 2 ? 'col-3 w-100 pt-2 pb-2  carouselCol': 'col-3 w-100 pt-2 pb-2  carouselCol1'">
              <mat-card class="p-0 iterationCard" (click)="playVideo(projectPreviewDialog, videoDialog, material, material.doc_type, preview = true)">
                <div class="row ml-0 mr-0 carouselRow1">
                  <div class="col-12 m-auto">
                    <mat-icon class="iterationicons"
                      *ngIf="material.doc_type =='image/jpeg'  || material.doc_type == 'image/png' || material.doc_type == 'image/jpg'">
                      photo_size_select_actual</mat-icon>
                    <mat-icon class="iterationicons" *ngIf="material.doc_type =='video/mp4'">play_circle_outline</mat-icon>
                    <i class="fa fa-file-pdf-o iterationicons" *ngIf="material.doc_type =='application/pdf'" aria-hidden="true"></i>
                  </div>
                </div>
                <div class="row ml-0 mr-0 h-40" class="fileSelDet">
                  <div class="col-12 pr-0 fileNameCol">
                  <!-- <div class="col-12 text-center mt-2 mb-2 pl-0 pr-0"> -->
                    <span class="carouselText" *ngIf="material.filename?.length > 30">{{(material.filename| slice:0:20)+'...'}}</span>
                    <span class="carouselText" *ngIf="material.filename?.length < 30">{{material.filename}}</span>
                  </div>
                </div>
              </mat-card>
            </div>
          </ng-template>
        </owl-carousel-o>


          <!-- <div id="demo" class="carousel" data-ride="carousel">
            <div class="carousel-inner">
              <div class="carousel-item active">
                <div class="row ml-0 mr-0">
                  <div class="col-4 text-left pr-0" *ngFor="let material of performActivityData.materialDetails">
                <mat-card class="materialCard p-0 mr-2" >
                  <div class="row ml-0 mr-0 matCardIconRow">
                    <div class="col-12 pl-0 pr-0">
                      <i class="fa fa-file-pdf-o icons" *ngIf="material.doc_type == 'file/pdf' || material.doc_type == 'application/pdf'" aria-hidden="true"></i>
                      <mat-icon class="icons" *ngIf="material.doc_type == 'image/png' || material.doc_type == 'image/jpg' || material.doc_type == 'image/jpeg'">photo_size_select_actual</mat-icon>
                      <mat-icon class="icons" *ngIf="material.doc_type =='video/mp4'">play_circle_outline</mat-icon> 
                    </div>
                  </div>
                  <div class="row ml-0 mr-0 h-40" class="fileSelDet">
                    <div class="col-12 pr-0 fileNameCol">
                      <span class="fileColor">{{(material.filename| slice:0:25)+'...'}}</span><br>
                    </div>
                  </div>
                </mat-card>
                </div>
                </div>
              </div>
            </div>
          
            <a class="carousel-control-prev" href="#demo" data-slide="prev">
              <span class="carousel-control-prev-icon"></span>
            </a>
            <a class="carousel-control-next" href="#demo" data-slide="next">
              <span class="carousel-control-next-icon"></span>
            </a>
          
          </div> -->
          
          <!-- <mat-card class="materialCard p-0 mr-2">
            <div class="row ml-0 mr-0">
              <div class="col-12 pl-0 pr-0">
                <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
              </div>
            </div>
            <div class="row ml-0 mr-0" class="fileSelDet">
              <div class="col-12">
                <span class="fileColor">x0avfd_001.pdf</span><br>
                <span class="fileColor">Reference</span>
              </div>
            </div>
          </mat-card>
          <mat-card class="materialCard p-0">
            <div class="row ml-0 mr-0">
              <div class="col-12 pl-0 pr-0">
                <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
              </div>
            </div>
            <div class="row ml-0 mr-0" class="fileSelDet">
              <div class="col-12">
                <span class="fileColor">x0avfd_001.pdf</span><br>
                <span class="fileColor">Reference</span>
              </div>
            </div>
          </mat-card> -->
        </div>
      </div>
      <div class="row ml-0 mr-0">
        <div class="col-12">
      
        </div>
      </div>
      <div class="row ml-0 mr-0 mt-3">
        <div class="col-12">
          <mat-card class="matCard mb-3" (click)="arrowUP = !arrowUP; openItration(i)" *ngFor="let itration of performActivityData.iterationDetails; let i = index">
            <div class="row ml-0 mr-0">
              <div class="col-3 pr-0 pl-0 text-left">
                <span>Itration {{itration.iterationcount}}</span>
              </div>
              <div class="col-4 pr-0 pl-0 text-center">
                <span>Score: <span *ngIf="itration.score_mark > 0">{{itration.score_mark}}</span>
                <span *ngIf="itration.score_mark == 0 || itration.score_mark == null">-</span> / {{itration.total_mark}}</span>
              </div>
              <div class="col-5 gradeStatusCol text-right">
                <span class="textGrayColor" *ngIf="itration.submit_status == 'notsubmitted' && itration.grade_status !== 'Evaluated'">Yet to Submit</span>
                <span class="submitstatus" *ngIf="itration.grade_status == 'Not Evaluated' && itration.submitAction == 'submit'">
                          Submitted</span>
                <span class="gradeStatus" *ngIf="itration.grade_status == 'Evaluated'">Graded <span
                  *ngIf="itration.grade_status == 'Evaluated' && itration.instructor_status !== null"
                  [ngClass]="itration.instructor_status === 'Pass'? 'colorGreen ml-1': 'colorRed ml-1'">{{itration.instructor_status | titlecase}}</span></span>
                <!-- <span class="text-success">Graded</span>&nbsp;&nbsp;
                <span class="text-primary">pass</span>&nbsp;&nbsp; -->
                <mat-icon class="matIcon" *ngIf="!arrowUP || openIndex !== i">keyboard_arrow_down</mat-icon>
                <mat-icon class="matIcon" *ngIf="arrowUP && openIndex == i">keyboard_arrow_up</mat-icon>
              </div>
            </div>
            <div class="row ml-0 mr-0" *ngIf="arrowUP && openIndex == i">
              <div class="col-12 pl-0 pr-0">
                <div class="row ml-0 mr-0 mt-3" *ngIf="itration.videodetails.length > 0">
                  <div class="col-12 text-left pl-0 pr-0">
                    <!-- <div id="demo" class="carousel" data-ride="carousel">
                      <div class="carousel-inner">
                        <div class="carousel-item active">
                          <div class="row ml-0 mr-0">
                            <div class="col-4 text-left pr-0" *ngFor="let videoData of itration.videodetails">
                          <mat-card class="materialCardItration p-0 mr-2" (click)="playVideo(projectPreviewDialog, videoDialog, videoData, videoData.doc_type, preview = true)">
                            <div class="row ml-0 mr-0 matCardIconRow">
                              <div class="col-12 pl-0 pr-0">
                                <i class="fa fa-file-pdf-o itrationicons" *ngIf="videoData.doc_type == 'file/pdf'" aria-hidden="true"></i>
                                <mat-icon class="itrationicons" *ngIf="videoData.doc_type =='image/jpeg'
                                     || videoData.doc_type == 'image/png' || videoData.doc_type == 'image/jpg'">photo_size_select_actual</mat-icon>
                                <mat-icon class="itrationicons" *ngIf="videoData.doc_type =='video/mp4'">play_circle_outline</mat-icon> 
                              </div>
                            </div>
                            <div class="row ml-0 mr-0 h-40" class="fileSelDet">
                              <div class="col-12 pr-0 fileNameCol">
                                <span class="fileColor">{{(videoData.name| slice:0:25)+'...'}}</span><br>
                              </div>
                            </div>
                          </mat-card>
                          </div>
                          </div>
                        </div>
                      </div>
                    
                      <a class="carousel-control-prev" href="#demo" data-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                      </a>
                      <a class="carousel-control-next" href="#demo" data-slide="next">
                        <span class="carousel-control-next-icon"></span>
                      </a>
                    </div> -->

                    <owl-carousel-o [options]="trendingCategorires"
                    [ngClass]="performActivityData.materialDetails.length >= 4 ? 'owlHeight': 'widthClass' ">
                    <ng-template class="row ml-0 mr-0" carouselSlide
                      *ngFor="let videoData of itration.videodetails; let i = index">
                      <div [ngClass]="performActivityData.materialDetails.length >= 2 ? 'col-3 w-100 pt-2 pb-2  carouselCol': 'col-3 w-100 pt-2 pb-2  carouselCol1'">
                        <mat-card class="p-0 iterationCard" >
                          <div class="row ml-0 mr-0 itCarouselRow1">
                            <div class="col-12 m-auto">
                              <mat-icon class="closeIcon" *ngIf="itration.submit_status == 'notsubmitted'" (click)="submitType = 'delete'; submitDeleteVideo(videoData, itration, performActivityData)">close</mat-icon>
                              <mat-icon class="iterationicons" (click)="playVideo(projectPreviewDialog, videoDialog, videoData, videoData.doc_type, preview = true)"
                                *ngIf="videoData.doc_type =='image/jpeg'  || videoData.doc_type == 'image/png' || videoData.doc_type == 'image/jpg'">
                                photo_size_select_actual</mat-icon>
                              <mat-icon class="iterationicons" (click)="playVideo(projectPreviewDialog, videoDialog, videoData, videoData.doc_type, preview = true)" *ngIf="videoData.doc_type =='video/mp4'">play_circle_outline</mat-icon>
                              <i class="fa fa-file-pdf-o iterationicons" (click)="playVideo(projectPreviewDialog, videoDialog, videoData, videoData.doc_type, preview = true)" *ngIf="videoData.doc_type =='application/pdf'" aria-hidden="true"></i>
                            </div>
                          </div>
                          <div class="row ml-0 mr-0 h-40" class="fileSelDet" (click)="playVideo(projectPreviewDialog, videoDialog, videoData, videoData.doc_type, preview = true)">
                            <div class="col-12 pr-0 fileNameCol">
                            <!-- <div class="col-12 text-center mt-2 mb-2 pl-0 pr-0"> -->
                              <span class="carouselText" *ngIf="videoData.name?.length > 40">{{(videoData.name| slice:0:30)+'...'}}</span>
                              <span class="carouselText" *ngIf="videoData.name?.length < 40">{{videoData.name}}</span>
                            </div>
                          </div>
                        </mat-card>
                      </div>
                    </ng-template>
                  </owl-carousel-o>
                    
                  </div>
                </div> 
              
              <div class="row ml-0 mr-0 mt-2">
              <div class="col-12 text-center" *ngIf="itration.grade_status !== 'Evaluated'"> 
                <button mat-raised-button (click)="videoRecord = true; getData(videoRecordPopup, itration)" class="recordBtn mt-3 w-100" *ngIf="itration.submitAction !== 'submit'"><mat-icon class="video-icon">videocam <i class="fa fa-youtube-play playBtn" aria-hidden="true"></i></mat-icon> Record Video
                </button>
                <input type="file" accept="video/mp4" multiple style="display: none" #videoInput
                    (change)="uploadDocument($event)" />
                <button mat-stroked-button class="uploadBtn mt-3 w-100" *ngIf="itration.submit_status == 'notsubmitted' || !itrationStarted && !itrationEnded"
                 (click)="uploadDocuments(itration, performActivityData, submitType = 'upload')"><mat-icon class="add-icon">add</mat-icon>Upload Videos</button>
                <button mat-stroked-button class="submitBtn mt-3" *ngIf="itration.submit_status == 'notsubmitted' && itration.videodetails.length > 0"
                  (click)="submitType = 'submit'; submitDeleteVideo({}, itration, performActivityData)">Submit</button>
                <button mat-stroked-button *ngIf="itration.submit_status == 'notsubmitted' && itration.videodetails.length == 0 && !itrationStarted && !itrationEnded" class="submitted-btn mt-3"> Submit </button>
                <button mat-stroked-button *ngIf="itration.submitAction == 'submit'" class="submitted-btn mt-3"> Submitted </button>
                <div class="align-center mt-2">
                  <span *ngIf="itration.videodetails.length > 0  && itration.submitAction !== 'submit'"
                    class="submitedFile">Submitted files cannot be edited</span>
                  <span class="uploadedFile" *ngIf="itration.submitAction == 'submit'">Submitted on :
                    {{itration.submitted_on | date}}</span>
                </div>
              </div>
              <div class="col-12 pl-0 pr-0" *ngIf="itration.grade_status === 'Evaluated'">
                <div class="row ml-0 mr-0">
                  <div class="col-12">
                    <button mat-stroked-button class="AssignmentBtn mt-3 w-100" (click)="playVideo(projectPreviewDialog, videoDialog, itration.assessmentreport[0], itration.assessmentreport[0].doc_type)"><mat-icon class="assignmentIcon mr-2">wysiwyg</mat-icon>Assessment report</button>
                  </div>
                </div>
                <div class="row ml-0 mr-0 mt-2">
                  <div class="col-12 text-left">
                    <p class="feedBackTxt">Feedback comments</p>
                    <textarea disabled rows="4" cols="50" class="textArea">
                      {{itration.comments}}
                      </textarea>
                  </div>
                </div>
              </div>
            </div>
          </div>
            </div>
          </mat-card>
        </div>
      </div>
    </div>
  </div>
  <!-------------------------- Preview Video --------------------------------->
  <ng-template #videoDialog>
  <!-- <div class="row ml-0 mr-0 previewVideoScreen" *ngIf="videoPerview">
    <div class="col-12 pl-0 pr-0"> -->
      <div class="row ml-0 mr-0">
        <div class="col-6 text-left mt-2">
          <span class="previewTxt">Preview Video</span>
          </div>
          <div class="col-6 text-right">
            <button mat-mini-fab class="closeBtn">
              <mat-icon class="download-icon" (click)="closedialogbox()">close</mat-icon>
            </button>
          </div>
          </div>
          <div class="row ml-0 mr-0 mt-2 videoPlay">
            <div class="col-12 pl-0 pr-0">
          <video _ngcontent-tls-c58 class="videoCell" controls oncontextmenu="return false;" width="100%" src="{{videoSource}}"></video>
          </div>
          </div>
    <!-- </div>
  </div> -->
</ng-template>

  <!-------------------Preview for Project------------------>

<ng-template #projectPreviewDialog>
  <div class="row ml-0 mr-0 mb-3">
    <div class="col-12 text-right">
    <button mat-mini-fab class="closeBtn">
      <mat-icon class="download-icon" (click)="closedialogbox()">close</mat-icon>
    </button>
  </div>
  </div>
  <div class="row ml-0 mr-0" *ngIf="previewDoc">
    <div class="col-12 pl-0 pr-0">
    <app-pdfreader [url]="previewDoc"></app-pdfreader>
  </div>
  </div>
</ng-template>
  <!------------- Video Recordpopup ------------------------>
  <ng-template #videoRecordPopup>
  <!-- <div class="row ml-0 mr-0 videoRecordOverLay" *ngIf="videoRecord" > -->
    <div class="row ml-0 mr-0 w-100">
      <div class="col-12 pl-0 pr-0">
        <div class="row ml-0 mr-0 mt-2 closeRow" *ngIf="!videoStart">
          <div class="col-sm-12 text-right">
            <mat-icon class="closeIcon" (click)="closeDialog()">close</mat-icon>
          </div>
        </div>
        <div class="row ml-0 mr-0 videoRec">
          <div class="col-12 pl-0 pr-0" *ngIf="!videoStart">
            <!-- <app-video-recorder></app-video-recorder> -->
            <app-perform-video-record [performDetailsSend]="performActivityData" [itrationSend]="itrationDataSend"></app-perform-video-record>
            </div>
            <div class="col-12 previewCol" *ngIf="videoStart">
              <mat-card class="previewCard m-auto p-0">
                <div class="row ml-0 mr-0">
                  <div class="col-12 pl-0 pr-0">
                    <video _ngcontent-tls-c58 class="videoCell" controls oncontextmenu="return false;" width="100%" src="{{videoUrl}}"></video>
                  </div>
                </div>
                <div class="row ml-0 mr-0">
                  <div class="col-12 text-left">
                    <p class="textSize mt-3">file name x151</p>
                    <p class="textSize"><span class="font-weight-bold">MP4 . </span>&nbsp; Recorded on: Sep 24, 2020</p>
                  </div>
                </div>
              </mat-card>
            </div>
            </div>
            <div class="row ml-0 mr-0 mt-2" *ngIf="videoStart">
              <div class="col-12">
                <button mat-stroked-button class="cancelBtn mr-4" (click)="videoPerview = !videoPerview; closeDialog()">Cancel</button>
                <button mat-stroked-button class="saveBtn" (click)="videoPerview = !videoPerview; learnerRecordVideo()">Save</button>
              </div>
            </div>
        </div>
        </div>
  <!-- </div> -->
</ng-template>
</div> 
  
