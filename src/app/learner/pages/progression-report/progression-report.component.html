<app-header></app-header>
<div class="progression-report-contianer d-flex">
  <div class="left-container">
    <ul class="breadcrumb">
      <li><em routerLink="/Learner/MyCourse" class="lxp-Go backArrow"></em> {{courseName}}</li>
      <li>Learning Progression</li>
    </ul>
    <!-- <div class="col mt-2">
      <div class="header-label">Progression Report</div>
    </div> -->
    <div class="col">
      <div class="flag-line">

      </div>
    </div>
    <div class="col secPie">
      <div class="col-md-6">
        <div class="learning-label">Self Learning</div>
        <div class="pieChart" [ngStyle]="{'width': '300px',  'height':'300px'}">
          <canvas id="piechart" [plugins]="chartPlugins"></canvas>
        </div>
      </div>
      <div class="col-md-6 d-flex align-item-center">
        <div class="activities-progress w-100">
          <div class="progress-label">Activities</div>
          <div class="d-flex  h-10" [ngClass]="pieData.assignment_total==pieData.assignment_completed?'color-green':'color-yellow'">
            <div class="type-label">Assignment</div>
            <mat-progress-bar [mode]="mode"
              [value]="percentageCalc(pieData.assignment_completed,pieData.assignment_total)"
              [bufferValue]="bufferValue"></mat-progress-bar>
            <div class="mark-level">{{pieData.assignment_completed +'/'+pieData.assignment_total}}</div>
          </div>
          <div class="d-flex h-10" [ngClass]="pieData.project_total==pieData.project_completed?'color-green':'color-yellow'">
            <div class="type-label">Project</div>
            <mat-progress-bar [mode]="mode" [value]="percentageCalc(pieData.project_completed,pieData.project_total)"
              [bufferValue]="bufferValue"></mat-progress-bar>
            <div class="mark-level">{{pieData.project_completed +'/'+pieData.project_total}}</div>
          </div>
          <div class="d-flex h-10" [ngClass]="pieData.perform_total==pieData.perform_completed?'color-green':'color-yellow'">
            <div class="type-label">Perform</div>
            <mat-progress-bar [mode]="mode" [value]="percentageCalc(pieData.perform_completed,pieData.perform_total)"
              [bufferValue]="bufferValue"></mat-progress-bar>
            <div class="mark-level">{{pieData.perform_completed +'/'+pieData.perform_total}}</div>
          </div>
          <div class="d-flex h-10" [ngClass]="pieData.liveclassroom_total==pieData.liveclassroom_completed?'color-green':'color-yellow'">
            <div class="type-label">
              <ng-container *ngIf="UserDetails.org_type !== 'collegeconnect'">Live Interactions</ng-container>
              <ng-container *ngIf="UserDetails.org_type == 'collegeconnect'">Industry Talk</ng-container>
            </div>
            <mat-progress-bar [mode]="mode"
              [value]="percentageCalc(pieData.liveclassroom_completed,pieData.liveclassroom_total)"
              [bufferValue]="bufferValue"></mat-progress-bar>
            <div class="mark-level">{{pieData.liveclassroom_completed +'/'+pieData.liveclassroom_total}}</div>
          </div>
        </div>
      </div>
    </div>
    <div class="col">
      <div class="self-learning-container">
        <div class="header-label">Self Learning Progression Report</div>
        <div *ngIf="!showProgReport">
          <ngx-skeleton-loader count="5" [theme]="{ 'border-radius': '0', height: '50px' }"></ngx-skeleton-loader>
        </div>
        <div class="expansion-container" *ngIf="showProgReport && isTableData;else noCourseCard">
          <ng-container  *ngFor="let moduleItem of apidata let i = index">
          <div *ngIf="moduleItem.week !== apidata[i-1]?.week" [ngClass]="moduleItem.overAllPercentage>0?moduleItem.overAllPercentage>99?'bar-complete':'bar-inprogress':'bar-inprogress'">
            <div class="loopClass">
            <mat-progress-bar [mode]="mode" [value]="moduleItem.overAllPercentage" [bufferValue]="bufferValue">
            </mat-progress-bar>
              <ng-container *ngFor="let moduleItem of apidata;let number = index">
                <div class="innerLoop" *ngIf="moduleItem.week === apidata[i]?.week">
            <mat-accordion>
              <mat-expansion-panel (opened)="handleOpened(moduleItem)" (closed)="handleClosed(moduleItem)">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <div class="week-block">
                      <span>
                        <div [ngStyle]="(moduleItem.week!==apidata[number-1]?.week || moduleItem.isOpened) ? {'color': 'inherit'} : {'color': 'white'}" class="week-text">Week</div>
                        <div [ngStyle]="(moduleItem.week!==apidata[number-1]?.week || moduleItem.isOpened) ? {'color': 'inherit'} : {'color': 'white'}" class="week-number">{{numPrefix(moduleItem.week)}}</div>
                      </span>
                    </div>

                    <div class="rightSec">
                      <div class="weekModuleName">
                        <div class="week-text">Module</div>
                        <div class="module-block">{{moduleItem.name}}</div>
                      </div>
                      <div class="subinfo infos">
                        <div>
                          <div class="week-text">Topics</div>
                          <div>{{moduleItem.topicCount.completed+'/'+moduleItem.topicCount.total}}</div>
                        </div>
                        <div>
                          <div class="week-text">Knowledge Check</div>
                          <!-- <div>{{moduleItem.knowledgeCount.completed+'/'+moduleItem.knowledgeCount.total}}</div> -->
                          <div>-- / --</div>
                        </div>
                        <div>
                          <div class="week-text">Time Spent</div>
                          <div>{{moduleItem.totalDuration?(secondsTimeConverter(moduleItem.totalDuration)):'-- : -- : --'}}
                          </div>
                        </div>
                      </div>
                      <div class="statusring statusProgression">
                        <circle-progress [percent]='moduleItem.overAllPercentage' [radius]=17 [space]=-3
                          [outerStrokeGradient]=false [outerStrokeWidth]=3
                          [outerStrokeColor]='moduleItem.overAllPercentage>99?"#32CE6A":"#FFA800"'
                          [innerStrokeColor]="'#bfbdbd'" [innerStrokeWidth]=3 [animation]="true" [animationDuration]="300"
                          [showSubtitle]="false" [titleFontSize]=13>
                        </circle-progress>
                      </div>
                    </div>
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <div class="topic-container"
                  *ngFor="let topicItem of moduleItem.topicDetails; let topicIndex = index">
                  <div class="leftPan"> 
                      <div class="week-text">Topic: {{topicIndex+1}}</div>
                      <div class="font-weight-bold module-block">{{topicItem.name}}</div> 
                  </div>
                  <div class="rightpan">
                    <div class="laya">
                      <div class="types">Self Learning</div>
                      <div>
                        <div class="week-text">Time Spent</div>
                        <div class="font-weight-bold">
                          {{topicItem.activityDetails.totalDuration?secondsTimeConverter(topicItem.activityDetails.totalDuration):'-- : -- : --'}}</div>
                      </div>
                      <div>
                        <div class="week-text">Completion Level</div>
                        <div class="font-weight-bold">{{topicItem.activityDetails.completedPercentage}}%
                        </div>
                      </div>
                      <div></div>
                    </div>
                    <div class="layb">
                      <div class="types">Knowledge Check</div>
                      <div>
                        <div class="week-text">Attempted</div>
                        <div class="font-weight-bold">
                          {{topicItem.knowledgeDetails.totalQuestion?topicItem.knowledgeDetails.totalQuestion :'--'}}
                        </div>
                      </div>
                      <div>
                        <div class="week-text">Correct</div>
                        <div class="font-weight-bold color-green">
                          {{topicItem.knowledgeDetails.correctAns?topicItem.knowledgeDetails.correctAns:'--'}}</div>
                      </div>
                      <div>
                        <div class="week-text">Incorrect</div>
                        <div class="font-weight-bold color-red">
                          {{topicItem.knowledgeDetails.incorrect?topicItem.knowledgeDetails.incorrect:'--'}}</div>
                      </div>
                    </div>
                  </div>
                  <div class="statusarea">
                    <span *ngIf="topicItem.status.value == 'completed'" class="icon lxp-Tick green"></span>
                    <span *ngIf="topicItem.status.value == 'inprogress'" class="icon lxp-Timer_Outlined orange"></span>
                    <span *ngIf="topicItem.status.value == 'yetToStart'" class="icon lxp-Play grey"></span>
                  </div>
                </div>

              </mat-expansion-panel>
            </mat-accordion>
                </div>
              </ng-container>
            </div>
          </div>
        </ng-container>
        </div>
      </div>
    </div>
   <div class="col">
    <div class="activity-container">
      <div class="header-label">Activities Progression Report</div>
      <div class="tab-container">
        <mat-tab-group (selectedTabChange)="tabChanged($event)" [(selectedIndex)]="selectedIndex">
          <mat-tab label="Assignment">
            <div *ngIf="!showSkeleton; else skeletonLoad">
              <div class="card-content d-flex justify-content-start">
                <mat-card *ngFor="let assignmentModule of assignmentPage | async" class="card-container">
                  <div class="card-topic">
                    {{assignmentModule?.files?.module_id}} > {{assignmentModule?.files?.topic_id}}
                  </div>
                  <div class="card-strip"
                    [ngClass]="{'card-strip-grey': assignmentModule?.files?.submit_status === 'notsubmitted', 'card-strip-green': assignmentModule?.files?.submit_status === 'ontime', 'card-strip-red': assignmentModule?.files?.submit_status === 'late'}">
                  </div>
                  <div class="card-description mt-4 font-weight-bold">{{assignmentModule?.files?.activityname}}</div>
                  <div class="d-flex justify-content-between align-item-center mb-3">
                    <div class="date-content">
                      <div class="sub-header">Due on</div>
                      <div class="date-value">{{assignmentModule?.files?.activityenddate | date :'dd/MM/yyyy'}}</div>
                    </div>
                    <div class="date-content">
                      <div class="sub-header">Submitted on</div>
                      <div class="date-value" *ngIf="assignmentModule?.files?.submitted_date">
                        {{assignmentModule?.files?.submitted_date | date :'dd/MM/yyyy'}}</div>
                      <div class="date-value" *ngIf="!assignmentModule?.files?.submitted_date">--</div>
                    </div>
                  </div>
                  <div class="lastRow d-flex justify-content-between align-item-center">
                    <div class="date-content first-content">
                      <div class="sub-header">Status</div>
                      <div class="statusCaps status-value-grey"
                        *ngIf="assignmentModule?.files?.submit_status == 'notsubmitted'">
                        {{'Yet to Submit' | translate }}
                      </div>
                      <div class="statusCaps status-value-green"
                        *ngIf="assignmentModule?.files?.submit_status == 'ontime'">
                        {{'OnTime' | translate }}
                      </div>
                      <div class="statusCaps status-value-green"
                        *ngIf="assignmentModule?.files?.submit_status == 'submitted' || assignmentModule?.files?.submit_status == 'graded'">
                        {{'Completed' | translate }}
                      </div>
                      <div class="statusCaps status-value-red" *ngIf="assignmentModule?.files?.submit_status == 'late'">
                        {{'Late' | translate }}
                      </div>
                    </div>
                    
                    <div class="icon-content">
                      <div class="date-content score-content">
                        <div class="sub-header">Score</div>
                        <div class="score-value">{{assignmentModule?.files?.score_mark ?
                          assignmentModule?.files?.score_mark : '--'}}/{{assignmentModule?.files?.total_mark}}</div>
                      </div>
                      <em class="lxp-Assignments file-icon"></em>
                    </div>
                  </div>
                </mat-card>
              </div>
              <mat-paginator *ngIf="!emptyAssignment" #firstPaginator [pageSizeOptions]="[6]"></mat-paginator>
              <div class="noCard" *ngIf="emptyAssignment">
                <figure>
                  <img src="/assets/images/noassignment.svg" alt="assignment">
                </figure>
                <p> You have no Assignment activity at the moment!</p>
              </div>
            </div>
          </mat-tab>
          <mat-tab label="Project">
            <div *ngIf="!showSkeleton; else skeletonLoad">
              <div class="card-content d-flex justify-content-start">
                <mat-card *ngFor="let projectModule of projectPage | async" class="card-container">
                  <div class="card-topic">
                    {{projectModule?.projectActivity?.module_id}} > {{projectModule?.projectActivity?.topic_id}}
                  </div>
                  <div class="card-strip"
                    [ngClass]="{'card-strip-grey': projectModule?.projectActivity?.submit_status === 'notsubmitted', 'card-strip-green': projectModule?.projectActivity?.submit_status === 'ontime', 'card-strip-red': projectModule?.projectActivity?.submit_status === 'late'}">
                  </div>
                  <div class="card-description mt-4 font-weight-bold">{{projectModule?.projectActivity?.activityname}}
                  </div>
                  <div class="d-flex justify-content-between align-item-center mb-3">
                    <div class="date-content">
                      <div class="sub-header">Due on</div>
                      <div class="date-value">{{projectModule?.projectActivity?.activityenddate | date :'dd/MM/yyyy'}}
                      </div>
                    </div>
                    <div class="date-content">
                      <div class="sub-header">Submitted on</div>
                      <div class="date-value" *ngIf="projectModule?.projectActivity?.submitted_date">
                        {{projectModule?.projectActivity?.submitted_date | date :'dd/MM/yyyy'}}</div>
                      <div class="date-value" *ngIf="!projectModule?.projectActivity?.submitted_date">--</div>
                    </div>
                  </div>
                  <div class="lastRow d-flex justify-content-between align-item-center">
                    <div class="date-content first-content">
                      <div class="sub-header">Status</div>
                      <div class="statusCaps status-value-grey"
                        *ngIf="projectModule?.projectActivity?.submit_status == 'notsubmitted'">
                        {{'Yet to Submit' | translate }}
                      </div>
                      <div class="statusCaps status-value-green"
                        *ngIf="projectModule?.projectActivity?.submit_status == 'ontime'">
                        {{'OnTime' | translate }}
                      </div>
                      <div class="statusCaps status-value-green"
                        *ngIf="projectModule?.projectActivity?.submit_status == 'submitted' || projectModule?.projectActivity?.submit_status == 'graded'">
                        {{'Completed' | translate }}
                      </div>
                      <div class="statusCaps status-value-red"
                        *ngIf="projectModule?.projectActivity?.submit_status == 'late'">
                        {{'Late' | translate }}
                      </div>
                    </div>
                    <div class="date-content score-content">
                      <div class="sub-header">Score</div>
                      <div class="score-value">{{projectModule?.projectActivity?.score_mark ?
                        projectModule?.projectActivity?.score_mark :
                        '--'}}/{{projectModule?.projectActivity?.total_mark}}</div>
                    </div>
                    <div class="icon-content">
                      <em class="lxp-Assignments file-icon"></em>
                    </div>
                  </div>
                </mat-card>
              </div>
              <mat-paginator *ngIf="!emptyProject" #secondPaginator [pageSizeOptions]="[6]"></mat-paginator>
              <div class="noCard" *ngIf="emptyProject">
                <figure>
                  <img src="/assets/images/noproject.svg" alt="assignment">
                </figure>
                <p>You have no Project activity at the moment!</p>
              </div>
            </div>
          </mat-tab>
          <mat-tab label="Perform">
            <div *ngIf="!showSkeleton; else skeletonLoad">
              <div class="card-content d-flex justify-content-start">
                <mat-card *ngFor="let performModule of performPage | async" class="card-container">
                  <div class="card-topic">
                    {{performModule?.module_id}} > {{performModule?.topic_id}}
                  </div>
                  <div class="card-strip"
                    [ngClass]="{'card-strip-grey': performModule?.submit_status === 'notsubmitted', 'card-strip-green': performModule?.submit_status === 'ontime', 'card-strip-red': performModule?.submit_status === 'late'}">
                  </div>
                  <div class="card-description mt-4 font-weight-bold">{{performModule?.activityname}}</div>
                  <div class="d-flex justify-content-between align-item-center mb-3">
                    <div class="date-content">
                      <div class="sub-header">Due on</div>
                      <div class="date-value">{{performModule?.activityenddate | date :'dd/MM/yyyy'}}</div>
                    </div>
                    <div class="date-content">
                      <div class="sub-header">Submitted on</div>
                      <div class="date-value" *ngIf="performModule?.submitted_date">{{performModule?.submitted_date |
                        date :'dd/MM/yyyy'}}</div>
                      <div class="date-value" *ngIf="!performModule?.submitted_date">--</div>
                    </div>
                  </div>
                  <div class="lastRow d-flex justify-content-between align-item-center">
                    <div class="date-content first-content">
                      <div class="sub-header">Status</div>
                      <div class="statusCaps status-value-grey" *ngIf="performModule?.submit_status == 'notsubmitted'">
                        {{'Yet to Submit' | translate }}
                      </div>
                      <div class="statusCaps status-value-green" *ngIf="performModule?.submit_status == 'ontime'">
                        {{'OnTime' | translate }}
                      </div>
                      <div class="statusCaps status-value-green"
                        *ngIf="performModule?.submit_status == 'submitted' || performModule?.submit_status == 'graded'">
                        {{'Completed' | translate }}
                      </div>
                      <div class="statusCaps status-value-red" *ngIf="performModule?.submit_status == 'late'">
                        {{'Late' | translate }}
                      </div>
                    </div>
                    <div class="date-content score-content">
                      <div class="sub-header">Score</div>
                      <div class="score-value">{{performModule?.score_mark ? performModule?.score_mark :
                        '--'}}/{{performModule?.total_mark}}</div>
                    </div>
                    <div class="icon-content">
                      <em class="lxp-Assignments file-icon"></em>
                    </div>
                  </div>
                </mat-card>
              </div>
              <mat-paginator *ngIf="!emptyPerform" #thirdPaginator [pageSizeOptions]="[6]"></mat-paginator>
              <div class="noCard" *ngIf="emptyPerform">
                <figure>
                  <img src="/assets/images/noperform.svg" alt="assignment">
                </figure>
                <p>You have no Perform activity at the moment!</p>
              </div>
            </div>
          </mat-tab>
        </mat-tab-group>
      </div>
    </div>
  </div>
  </div>
  <div class="right-container"> 
    <!-- <div class="comingSoon">
      <div style="margin-bottom: 40px; text-align: center;">Your weekly time spent report will be displayed here!</div>
      <img class="d-flex m-auto" src="/assets/images/timeSpentHolder.png">
    </div> -->
    <div>
   <div class="progress-label">Week wise time spent</div>
   <div class="progress-date d-flex">
     <div class="progress-hours-container">
      <h4 class="progress-hours">{{totalhoursSpend}}</h4>
      <span class="hours-spent-label">Hours Spent</span>
     </div>
     <div class="progress-date-input">
      <mat-form-field style="width:150px;">
        <input matInput [matDatepicker]="weekWiseDatepicker" placeholder="Choose a date" [(ngModel)]="weekWiseDate" 
        (dateChange)="changeWeekDate()" [max]="today">
        <mat-datepicker-toggle matSuffix [for]="weekWiseDatepicker"></mat-datepicker-toggle>
        <mat-datepicker #weekWiseDatepicker></mat-datepicker>
      </mat-form-field>
     </div>
   </div>
   <div class="chart-container">
   <h6>Time in minutes</h6>
    <div [ngStyle]="{'width': '380px'}">
      <canvas baseChart [datasets]="barChartData" [labels]="barChartLabels" [options]="barChartOptions"
        [plugins]="barChartPlugins" [legend]="barChartLegend" [chartType]="barChartType"></canvas>
    </div>
  </div>
    <!-- <div class="col d-flex mt-3 justify-content-center">
      <div class="col-5 content-border">
        <div class="d-flex left-content">
          <div class="hours">68</div>
          <div class="hrs">hrs</div>
          <div class="week-percentage color-green"><em class="lxp-Up"></em><span class="percentage-text">12%</span>
          </div>
        </div>
        <div class="left-week">This Week</div>
      </div>
      <div class="col-6">
        <div class="d-flex right-content">
          <div class="hours">43</div>
          <div class="hrs">hrs</div>
          <div class="week-percentage color-red"><em class="lxp-Down"></em><span class="percentage-text">8%</span></div>
        </div>
        <div class="right-week">Last Week</div>
      </div>
    </div> -->
    <!-- <div class="d-flex growth">
      <div>You have a </div>
      <div class="text-green">&nbsp;12% learning growth</div>
    </div> -->
    <div class="col mt-4">
      <!-- <div class="col">
        <div class="statistics">Course Statistics</div>
      </div> -->
      <div class="col d-flex">
        <div class="numbers">87%</div>
        <div class="mr-2 numbers-text">Completeion <br /> Rate</div>
        <!-- <div class="numbers">35</div>
        <div class="numbers-text">Questions <br />Asked</div> -->
      </div>
      <div class="col d-flex mt-3">
        <div class="font-weight-bold">24&nbsp;</div>
        <div>Students have already completed the course</div>
      </div>
    </div>
  </div>
</div>
</div>

<ng-template #skeletonLoad>
  <div class="skeleton d-flex justify-content-between">
    <div class="item item1">
      <ngx-skeleton-loader class="loaderStyle" count="1"></ngx-skeleton-loader>
      <ngx-skeleton-loader class="loaderStyle" count="1"></ngx-skeleton-loader>
      <ngx-skeleton-loader class="loaderStyle" count="1"></ngx-skeleton-loader>
      <ngx-skeleton-loader class="loaderStyle" count="1"></ngx-skeleton-loader>
      <ngx-skeleton-loader class="loaderStyle" count="1"></ngx-skeleton-loader>
    </div>
    <div class="item item2">
      <ngx-skeleton-loader class="loaderStyle" count="1"></ngx-skeleton-loader>
      <ngx-skeleton-loader class="loaderStyle" count="1"></ngx-skeleton-loader>
      <ngx-skeleton-loader class="loaderStyle" count="1"></ngx-skeleton-loader>
      <ngx-skeleton-loader class="loaderStyle" count="1"></ngx-skeleton-loader>
      <ngx-skeleton-loader class="loaderStyle" count="1"></ngx-skeleton-loader>
    </div>
    <div class="item item3">
      <ngx-skeleton-loader class="loaderStyle" count="1"></ngx-skeleton-loader>
      <ngx-skeleton-loader class="loaderStyle" count="1"></ngx-skeleton-loader>
      <ngx-skeleton-loader class="loaderStyle" count="1"></ngx-skeleton-loader>
      <ngx-skeleton-loader class="loaderStyle" count="1"></ngx-skeleton-loader>
      <ngx-skeleton-loader class="loaderStyle" count="1"></ngx-skeleton-loader>
    </div>
  </div>
</ng-template>

<ng-template #noCourseCard>
  <div class="noCard">
      <div>
        <img src="/assets/images/noactivity.svg" alt="assignment">
      </div>
      <p>Please start the course to view your progression report!</p>
  </div>
</ng-template>
